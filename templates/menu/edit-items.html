{% extends "base.html" %}
{% load static %}
{% block title %}Edit Item{% endblock title %}

{% block content %}
<h2>Edit Item</h2>

{% if message %}
    <div style="color: red;">{{ message }}</div>
{% endif %}

<form method="post">
    {% csrf_token %}
    
    <label for="name">Item Name:</label>
    <input type="text" id="name" name="name" value="{{ item.name }}" required><br><br>

    <div id="variants-container">
        {% for variant in variants %}
        <div class="variant">
            <label>Variant:</label>
            <input type="text" name="variant_name[]" value="{{ variant.sku }}" required>

            <label>Price:</label>
            <input type="number" name="variant_price[]" step="0.01" value="{{ variant.price }}" required>

            <button type="button" onclick="removeVariant(this)">Remove</button>
        </div>
        {% endfor %}
    </div>

    <button type="button" onclick="addVariant()">Add Variant</button><br><br>

    <button type="submit">Save Changes</button>
</form>
{% endblock content %}

{% block javascript %}
{{ block.super }}
<script>
    function addVariant() {
        const container = document.getElementById('variants-container');
        const div = document.createElement('div');
        div.classList.add('variant');
        div.innerHTML = `
            <label>Variant:</label>
            <input type="text" name="variant_name[]" required>

            <label>Price:</label>
            <input type="number" name="variant_price[]" step="0.01" required>

            <button type="button" onclick="removeVariant(this)">Remove</button>
        `;
        container.appendChild(div);
    }

    function removeVariant(button) {
        const container = document.getElementById('variants-container');
        if (container.children.length > 1) {
            button.parentElement.remove();
        } else {
            alert("At least one variant is required.");
        }
    }
</script>
{% endblock javascript %}
